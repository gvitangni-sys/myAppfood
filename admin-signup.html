<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <title>Inscription Admin - MyAppFood</title>
  </head>
  <body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8">
      <!-- En-tête -->
      <div class="text-center mb-8">
        <div
          class="inline-flex items-center justify-center w-16 h-16 bg-orange-100 rounded-full mb-4"
        >
          <i class="fas fa-shield-alt text-orange-500 text-2xl"></i>
        </div>
        <h1 class="text-3xl font-bold text-gray-800">Inscription Admin</h1>
        <p class="text-gray-600 mt-2">Créez votre compte administrateur</p>
      </div>

      <!-- Formulaire d'inscription admin -->
      <form id="admin-signup-form" class="space-y-6">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Email Administrateur
          </label>
          <input
            type="email"
            id="admin-email"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg outline-none focus:border-orange-500 transition-colors"
            placeholder="admin@myappfood.com"
          />
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Mot de passe
          </label>
          <input
            type="password"
            id="admin-password"
            required
            minlength="4"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg outline-none focus:border-orange-500 transition-colors"
            placeholder="Votre mot de passe"
          />
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Confirmer le mot de passe
          </label>
          <input
            type="password"
            id="admin-password-confirm"
            required
            minlength="4"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg outline-none focus:border-orange-500 transition-colors"
            placeholder="Confirmer le mot de passe"
          />
        </div>

        <button
          type="submit"
          class="w-full py-3 bg-orange-500 text-white font-semibold rounded-lg hover:bg-orange-600 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center justify-center"
          id="signup-btn"
        >
          <i class="fas fa-user-shield mr-2"></i>
          <span>Créer le compte Admin</span>
        </button>
      </form>

      <!-- Message d'erreur -->
      <div
        id="error-message"
        class="hidden mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm"
      ></div>

      <!-- Lien vers la page normale -->
      <div class="mt-6 text-center">
        <a href="/" class="text-orange-500 hover:text-orange-600 font-medium">
          ← Retour à l'accueil
        </a>
      </div>
    </div>

    <script>
      document
        .getElementById("admin-signup-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const email = document.getElementById("admin-email").value;
          const password = document.getElementById("admin-password").value;
          const confirmPassword = document.getElementById(
            "admin-password-confirm"
          ).value;
          const button = document.getElementById("signup-btn");
          const errorDiv = document.getElementById("error-message");

          // Validation
          if (password !== confirmPassword) {
            errorDiv.textContent = "Les mots de passe ne correspondent pas";
            errorDiv.classList.remove("hidden");
            return;
          }

          if (password.length < 4) {
            errorDiv.textContent =
              "Le mot de passe doit contenir au moins 4 caracteres";
            errorDiv.classList.remove("hidden");
            return;
          }

          // Désactiver le bouton
          button.disabled = true;
          button.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i>Création...';

          try {
            const response = await fetch("/api/auth/admin-setup", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                email,
                motDePasse: password,
              }),
            });

            const data = await response.json();

            if (data.succes) {
              // Stocker le token et rediriger
              localStorage.setItem("adminToken", data.token);
              localStorage.setItem(
                "adminUser",
                JSON.stringify(data.utilisateur)
              );

              // Redirection directe vers le dashboard
              window.location.href = "/admin.html";
            } else {
              errorDiv.textContent =
                data.message || "Erreur lors de la création";
              errorDiv.classList.remove("hidden");
            }
          } catch (error) {
            errorDiv.textContent = "Erreur de connexion au serveur";
            errorDiv.classList.remove("hidden");
          } finally {
            button.disabled = false;
            button.innerHTML =
              '<i class="fas fa-user-shield mr-2"></i>Créer le compte Admin';
          }
        });
    </script>
  </body>
</html>
